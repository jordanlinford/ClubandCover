and click ➕ New File, name it:
test-seed.ts

Then paste this entire code:
import { FastifyInstance } from "fastify";
import { createClient } from "@supabase/supabase-js";

export default async function testSeedRoutes(fastify: FastifyInstance) {
  fastify.post("/api/test/seed-users", async (req, reply) => {
    // ✅ Only allow when explicitly enabled
    if (process.env.NODE_ENV === "production") {
      return reply.code(403).send({ error: "Forbidden in production" });
    }
    if (process.env.ENABLE_TEST_ROUTES !== "1") {
      return reply.code(403).send({ error: "Test routes not enabled" });
    }

    // ✅ Require a seed token header
    const token = req.headers["x-seed-token"];
    if (token !== process.env.TEST_SEED_TOKEN) {
      return reply.code(401).send({ error: "Unauthorized" });
    }

    // ✅ Use the service-role key (server-only)
    const supabase = createClient(
      process.env.SUPABASE_URL!,
      process.env.SUPABASE_SERVICE_ROLE_KEY!
    );

    const users = [
      { email: "alice.test+e2e@bookpitch.dev", password: "Test123!" },
      { email: "bob.test+e2e@bookpitch.dev", password: "Test123!" },
    ];

    const results: any[] = [];
    for (const u of users) {
      const { data, error } = await supabase.auth.admin.createUser({
        email: u.email,
        password: u.password,
        email_confirm: true,
        app_metadata: { seeded: true },
        user_metadata: { name: u.email.split("@")[0] },
      });
      results.push({
        email: u.email,
        id: data?.user?.id,
        error: error?.message ?? null,
      });
    }

    return { success: true, results };
  });
}


⚙️ 2️⃣  Register it in your API
Open apps/api/src/index.ts and near the other route registrations, add:
// ✅ Register test seed route only when enabled
if (process.env.ENABLE_TEST_ROUTES === "1") {
  const { default: testSeedRoutes } = await import("./routes/test-seed.js");
  fastify.register(testSeedRoutes);
}

(If your project uses .ts imports directly, change .js to .ts.)

⚙️ 3️⃣  Add two secrets in Replit → Secrets
ENABLE_TEST_ROUTES=1
TEST_SEED_TOKEN=my_super_secret_seed_token   # choose any random string

Do not add these to production—Replit Secrets are fine for dev/test.

⚙️ 4️⃣  Restart your app
pnpm dev:replit

You should see in logs:
✅ Connected to Supabase
✅ Test-seed route enabled
Listening on port 5000


⚙️ 5️⃣  Seed users for testing
From your Replit shell or any terminal:
curl -X POST https://<your-replit-app>.replit.app/api/test/seed-users \
  -H "x-seed-token: my_super_secret_seed_token"

Expected response:
{
  "success": true,
  "results": [
    {"email":"alice.test+e2e@bookpitch.dev","id":"<uuid>","error":null},
    {"email":"bob.test+e2e@bookpitch.dev","id":"<uuid>","error":null}
  ]
}

Now both users exist in Supabase Auth with passwords Test123!
→ You can log in manually, or have Playwright use them in tests.

⚙️ 6️⃣  (Optional) Turn it off
After tests, delete or set:
ENABLE_TEST_ROUTES=0

so it won’t register in production.

That’s all.
Paste exactly what’s above into Replit, restart, and your automated tests can seed real Supabase users instantly—no more “invalid email” issue.