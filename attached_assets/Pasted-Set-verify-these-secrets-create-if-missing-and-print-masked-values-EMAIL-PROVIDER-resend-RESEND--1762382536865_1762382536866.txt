Set/verify these secrets (create if missing) and print masked values:

EMAIL_PROVIDER=resend
RESEND_API_KEY=<YOUR_RESEND_KEY>
EMAIL_FROM="Book Pitch <noreply@yourdomain.com>"
CORS_ORIGIN=https://your-domain.replit.app
REFERRAL_BASE_URL=https://your-domain.replit.app/ref
CRON_KEY=<64-CHAR-HEX>   # e.g., output of: openssl rand -hex 64


After setting, restart the server and confirm they’re loaded on boot logs.

2) Add a tiny /api/version endpoint (tag this build “Sprint-5”)

Paste to Replit:

Create a lightweight version route.
File: apps/api/src/routes/version.ts

import { FastifyInstance } from 'fastify';

export default async function versionRoutes(f: FastifyInstance) {
  f.get('/api/version', async () => {
    return {
      name: 'Book Pitch',
      tag: 'Sprint-5',
      commit: process.env.GIT_SHA || 'unknown',
      ts: new Date().toISOString(),
    };
  });
}


Wire it in apps/api/src/index.ts:

import versionRoutes from './routes/version';
await fastify.register(versionRoutes);


Build & start, then print GET /api/version.

3) Lock down CORS (use the env you just set)

Paste to Replit (if not already done):

Update apps/api/src/index.ts CORS to respect CORS_ORIGIN:

await fastify.register(cors, {
  origin: process.env.CORS_ORIGIN || '*',
  credentials: true,
});
fastify.log.info({ corsOrigin: process.env.CORS_ORIGIN || '*' }, 'CORS configured');


Restart and print the Access-Control-Allow-Origin header when Origin: https://your-domain.replit.app.

4) Confirm CRON protection & give me the URLs

Paste to Replit:

Print the exact cron endpoints and test protection:

Call POST /api/cron/poll-reminders without key → expect 403.

Call with ?key=<CRON_KEY> and with header x-cron-key: <CRON_KEY> → expect **200 { ok:true, ... }`.

Echo the full URL I should schedule (with ?key=).

5) Quick smoke tests (copy/pasteable curl)

Paste to Replit:

Run a minimal smoke and inline outputs:

# Health
curl -s https://your-domain.replit.app/api/health

# Version
curl -s https://your-domain.replit.app/api/version

# Discovery (FTS + filters)
curl -s "https://your-domain.replit.app/api/discover/search?q=test&type=pitch&minPoints=0&page=1"

# Referral link generation (show built URL includes REFERRAL_BASE_URL)
curl -s -X POST https://your-domain.replit.app/api/referrals

# Cron dry run
curl -s -X POST "https://your-domain.replit.app/api/cron/poll-reminders?key=$CRON_KEY"


If any fail, print the failing route, payload, and response.

6) Final deployment checklist (print & pin)

Paste to Replit:

Print a final Deployment Checklist now that secrets are set:

EMAIL_PROVIDER = resend ✅

EMAIL_FROM set ✅

CORS_ORIGIN enforced (echo value + header) ✅

CRON_KEY set (do not print value) ✅

REFERRAL_BASE_URL set & used in generated links ✅

/api/health 200, /api/version shows Sprint-5 ✅

Cron URL (echo again) ✅

Links: docs/SPRINT5_PLAN.md, docs/ROUTE_MAP.md, docs/SMOKE_TEST_SPRINT5.md ✅

If you want me to schedule cron

Once Replit prints the exact cron URL, drop it here and I’ll give you the one-line config for cron-job.org (method, body, headers, schedule).